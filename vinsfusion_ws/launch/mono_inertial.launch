<launch>

    <param name="/use_sim_time" value="true"/>

    <!-- Config path -->
    <arg name="config_path" default="/root/catkin_ws/src/VINS-Fusion/config/vins_mono_imu_config.yaml" />
    <arg name="output_bag_name" default="/root/rosbags/new_odometry_output.bag" />
    <arg name="input_bag_name" default="/root/rosbags/new_vio_capture.bag" />

    <!-- RVIZ Node - commented out -->
    <!-- <node name="rviz" pkg="rviz" type="rviz" args="-d /root/catkin_ws/src/VINS-Fusion/config/vins_rviz_config.rviz" /> -->

    <!-- VINS Estimator Node -->
    <!-- Pass config file as command line argument using 'args' instead of 'param' -->
    <node name="vins_estimator" pkg="vins" type="vins_node" output="screen" args="$(arg config_path)" />

    <!-- oop Fusion Node for Loop Closure -->
    <node name="loop_fusion" pkg="loop_fusion" type="loop_fusion_node" output="screen" args="$(arg config_path)" />

    <!-- Record VINS odometry output -->
      <node pkg="rosbag" type="record" name="vins_odometry_recorder"
        args="-O /root/rosbags/$(arg output_bag_name) /vins_estimator/odometry"
        launch-prefix="bash -c 'sleep 5; $0 $@' "/>
    
    <!-- Record VIO to rosbag-->
    <?ignore <node pkg="rosbag" type="record" name="rosbag_recorder"
        args="-o /root/rosbags/vins_run.bag /mono_camera/image_raw /mavros/imu/data_raw /mavros/global_position/raw/fix /mavros/global_position/compass_hdg /mavros/distance_sensor/rangefinder_pub "
        launch-prefix="bash -c 'sleep 5; $0 $@' "/> ?>

    <!-- Optional: Pose Graph for loop closure -->
    <!-- Uncomment if you want loop closure functionality -->
    <!-- <node name="pose_graph" pkg="pose_graph" type="pose_graph_node" output="screen">
        <param name="config_file" type="string" value="$(arg config_path)" />
        <param name="visualization_shift_x" type="int" value="0" />
        <param name="visualization_shift_y" type="int" value="0" />
        <param name="skip_cnt" type="int" value="0" />
        <param name="skip_dis" type="double" value="0" />
    </node> -->

    <!-- ROS Bag Play Node - commented out -->
    <node pkg="rosbag" type="play" name="rosbag_play"
          args="--clock /root/rosbags/$(arg input_bag_name) -r 1.0"
          launch-prefix="bash -c 'sleep 3; $0 $@' "/> 

</launch>